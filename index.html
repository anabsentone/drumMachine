<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <!-- <link rel='shortcut icon' href='images/logo.png'> -->
        <!-- <link rel='stylesheet' type='text/css' href='css/html5reset.css'> -->
        
        <!-- Bootstrap 5.3 https://getbootstrap.com/docs/5.3/getting-started/introduction -->
        <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH' crossorigin='anonymous'>
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz' crossorigin='anonymous'></script>
        
        <script src="http://unpkg.com/tone"></script>
        
        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
        <title>Drum Machine</title>
        <style>
            body {
                margin: 5px;
                background-color: lightgray;
            }
            
            /* #controls {
                display: inline;
            } */
            
            #BPMInputDiv {
                width: 50vw;
            }
            
            #stopButtonDiv {
                display: none;
            }
        </style>
        
        <script>
            function generateBeatgrid() {
                var numBeats = 4;
                
                var tableHeaderRow = document.getElementById('beatgrid').getElementsByTagName('thead')[0].getElementsByTagName('tr')[0];
                var firstInstrumentRow = document.getElementById('beatgrid').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0];
                var secondInstrumentRow = document.getElementById('beatgrid').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[1];
                for (var i = 1; i < numBeats + 1; i++) {
                    var newTh;
                    var newTd;
                    var newInput;
                    var charA;
                    var charB;
                    for (var j = 0; j < 4; j++) {
                        switch (j) {
                            case 0:
                                charA = i;
                                charB = '#';
                                break;
                            case 1:
                                charA = 'E';
                                charB = 'E';
                                break;
                            case 2:
                                charA = '&';
                                charB = '&';
                                break;
                            case 3:
                                charA = 'A';
                                charB = 'A';
                                break;
                        }
                        newTh = document.createElement('th');
                        newTh.setAttribute('scope', 'col');
                        newTh.innerText = charA;
                        tableHeaderRow.appendChild(newTh);
                        
                        newTd = document.createElement('td');
                        newInput = document.createElement('input');
                        newInput.id = i + charB + 'HInput';
                        newInput.class = 'form-check-input';
                        newInput.type = 'checkbox';
                        newTd.appendChild(newInput);
                        firstInstrumentRow.appendChild(newTd);
                        
                        newTd = document.createElement('td');
                        newInput = document.createElement('input');
                        newInput.id = i + charB + 'SInput';
                        newInput.class = 'form-check-input';
                        newInput.type = 'checkbox';
                        newTd.appendChild(newInput);
                        secondInstrumentRow.appendChild(newTd);
                    }                    
                }
            }
            
            var now;
            var BPM = 100;
            var increment = (60 / BPM) / 4;
            
            const hihatSample = new Tone.Player('RD_C_HH_7.wav').toDestination();
            const snareSample = new Tone.Player('RD_S_P_10.wav').toDestination();
            
            function updateBPM() {
                document.getElementById('BPMInputLabel').innerText = document.getElementById('BPMInput').value + ' BPM';
                
                BPM = document.getElementById('BPMInput').value;
                increment = (60 / BPM) / 4;
                console.log(BPM);
                console.log(increment);
            }
            
            function play() {
                document.getElementById('playButtonDiv').style.display = 'none';
                document.getElementById('stopButtonDiv').style.display = 'initial';
                document.getElementById('BPMInput').disabled = true;
                
                now = Tone.now();
                // synth = new Tone.PolySynth(Tone.Synth).toDestination();
                // synth.triggerAttack("D4", now);
                // synth.triggerAttack("F4", now + 0.5);
                // synth.triggerAttack("A4", now + 1);
                // synth.triggerAttack("C5", now + 1.5);
                // synth.triggerAttack("E5", now + 2);
                // synth.triggerRelease(["D4", "F4", "A4", "C5", "E5"], now + 4);
                
                for (var i = 0; i < 5; i++) {
                    
                }
            }
            
            function stop() {
                document.getElementById('playButtonDiv').style.display = 'initial';
                document.getElementById('stopButtonDiv').style.display = 'none';
                document.getElementById('BPMInput').disabled = false;
            }
        </script>
    </head>

    <body class='container-fluid' onload='generateBeatgrid();'>
        <div id='controls'>
            <div id='BPMInputDiv'>
                <label id='BPMInputLabel' for='BPMInput' class='form-label'>100 BPM</label>
                <input id='BPMInput' type='range' class='form-range' min='70' max='140' value='100' oninput='updateBPM();'>
            </div>
            <div id='playerControls'>
                <div id='playButtonDiv'>
                    <button id='playButton' class='btn btn-md btn-secondary shadow m-2' onclick='play();'>▶</button>
                </div>
                <div id='stopButtonDiv'>
                    <button id='stopButton' class='btn btn-md btn-secondary shadow m-2' onclick='stop();'>⏹</button>
                </div>
            </div>
        </div>
        <div id='beatgrid'>
            <table class='table'>
                <thead>
                    <tr>
                        <th scope='col'>Instrument</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope='row'>Hi-Hat</th>
                    </tr>
                    <tr>
                        <th scope='row'>Snare</th>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>
</html>